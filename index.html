<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Cabinet24</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Telegram WebApp API -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <style>
    body {
      margin: 0;
      padding: 16px;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #f5f5f5;
    }
    .card {
      background: #fff;
      padding: 16px;
      border-radius: 12px;
    }
    h1 {
      margin-top: 0;
      font-size: 20px;
    }
    .muted {
      color: #777;
      font-size: 14px;
    }
  </style>
</head>
<body>

  <div class="card">
    <h1>Cabinet24</h1>
    <div id="user"></div>
    <div class="muted">Экран: Мои объекты (заглушка)</div>
  </div>

<div id="app"></div>

  <script>
  // [1] Инициализация Telegram
  const tg = window.Telegram.WebApp;
  tg.ready();

  // [2] Получаем пользователя
  const user = tg.initDataUnsafe?.user;

  // [3] Backend API (ВСТАВИМ ЧУТЬ ПОЗЖЕ)
  const API_URL = 'https://api.telegram.org/bot8589251044:AAGzYr3XUVZdRjrnIxqbH62JpnlFsI_jvCw/setWebhook?url=https://script.google.com/macros/s/AKfycbwhrjRTbMsEYa7v9PBhOBfrOsG2Zj-jbkI_FEN9F5u7uuTb6PkMgzZMGjNzNVsj6kZU1Q/exec';

  // [4] Контейнер для данных
  const app = document.getElementById('app');

  // [5] Точка входа
  if (!user) {
    app.innerText = 'Откройте приложение через Telegram';
  } else {
    loadData(user.id);
  }

  // [6] Запрос данных
  function loadData(telegramId) {
    fetch(`${API_URL}?telegramId=${telegramId}`)
      .then(r => r.json())
      .then(data => render(data))
      .catch(() => {
        app.innerText = 'Ошибка загрузки данных';
      });
  }

  function render(objects) {
  // [7.1] Защита: если данных нет
  if (!objects || objects.length === 0) {
    app.innerText = 'Нет объектов';
    return;
  }

  // [7.2] Очищаем контейнер
  app.innerHTML = '';

  // [7.3] Проходим по объектам
  objects.forEach(object => {
    const card = document.createElement('div');
    card.className = 'card';
    card.style.marginTop = '12px';

    // [7.4] Заголовок объекта
    let html = `
      <h2>${object.name || 'Объект'}</h2>
    `;

    // [7.5] Если у объекта есть услуги
    if (object.services && object.services.length > 0) {
      object.services.forEach(service => {
        html += `
          <div class="muted" style="margin-bottom: 8px;">
            <b>${service.name}</b><br>
            Статус: ${service.status}<br>
            Остаток: ${service.balance}
          </div>
        `;
      });
    } else {
      html += `<div class="muted">Нет услуг</div>`;
    }

    // [7.6] Вставляем HTML в карточку
    card.innerHTML = html;

    // [7.7] Добавляем карточку в приложение
    app.appendChild(card);
  });
}

</script>


</body>
</html>
