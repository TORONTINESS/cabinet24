<script>
const tg = window.Telegram.WebApp;
tg.ready();

const app = document.getElementById('app');

// ================================
// [1] –ü–æ–ª—É—á–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ü–†–ê–í–ò–õ–¨–ù–û
// ================================
let user = null;

// –ü—ã—Ç–∞–µ–º—Å—è —á–µ—Ä–µ–∑ initDataUnsafe (–µ—Å–ª–∏ –µ—Å—Ç—å)
if (tg.initDataUnsafe && tg.initDataUnsafe.user) {
  user = tg.initDataUnsafe.user;
}

// –ï—Å–ª–∏ –Ω–µ –ø–æ–ª—É—á–∏–ª–æ—Å—å ‚Äî –ø–∞—Ä—Å–∏–º initData
if (!user && tg.initData) {
  const params = new URLSearchParams(tg.initData);
  if (params.has('user')) {
    try {
      user = JSON.parse(params.get('user'));
    } catch (e) {}
  }
}

// ================================
// [2] –ü—Ä–æ–≤–µ—Ä–∫–∞
// ================================
if (!user || !user.id) {
  app.innerHTML = `
    <h2>–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏</h2>
    <p class="muted">
      Telegram –Ω–µ –ø–µ—Ä–µ–¥–∞–ª –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.<br>
      –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É –±–æ—Ç–∞.
    </p>
    <pre>${tg.initData || 'initData –ø—É—Å—Ç–æ'}</pre>
  `;
} else {
  app.innerHTML = `
    <h2>–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, ${user.first_name}</h2>
    <p class="muted">Telegram ID: ${user.id}</p>
    <p>üéâ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ</p>
  `;
}
</script>
